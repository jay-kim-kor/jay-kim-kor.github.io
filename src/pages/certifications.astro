---
import BaseLayout from '../layouts/BaseLayout.astro';

interface Certification {
  name: string;
  issuer: string;
  date: string;
  category?: string;
}

interface Training {
  name: string;
  institution: string;
  period: string;
  description?: string;
}

interface Education {
  name: string;
  degree: string;
  major: string;
  period: string;
}

interface Language {
  name: string;
  level: string;
  note?: string;
}

interface CertsData {
  certifications?: Certification[];
  training?: Training[];
  education?: Education[];
  languages?: Language[];
}

let data: CertsData = {};

try {
  const yamlFiles = import.meta.glob('../content/certifications.yaml', { eager: true, query: '?raw', import: 'default' });
  const raw = Object.values(yamlFiles)[0] as string | undefined;
  if (!raw) {
    const fallback = import.meta.glob('../data/certifications.yaml', { eager: true, query: '?raw', import: 'default' });
    const rawFallback = Object.values(fallback)[0] as string | undefined;
    if (rawFallback) {
      const { load } = await import('js-yaml');
      data = (load(rawFallback) as CertsData) ?? {};
    }
  } else {
    const { load } = await import('js-yaml');
    data = (load(raw) as CertsData) ?? {};
  }
} catch {
  // YAML 파일이 없으면 빈 상태 유지
}

const certifications = data.certifications ?? [];
const training = data.training ?? [];
const education = data.education ?? [];
const languages = data.languages ?? [];
const hasContent = certifications.length > 0 || training.length > 0 || education.length > 0;
---

<BaseLayout title="Certifications" description="자격증, 교육, 학력">
  <h1 class="section-title">Certifications & Education</h1>

  {!hasContent ? (
    <div class="card text-center py-12">
      <p class="text-surface-500 dark:text-surface-400">콘텐츠 준비 중입니다.</p>
    </div>
  ) : (
    <div class="space-y-12">
      {/* 자격증 */}
      {certifications.length > 0 && (
        <section>
          <h2 class="text-xl font-semibold text-surface-900 dark:text-white mb-4">자격증</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {certifications.map((cert) => (
              <div class="card">
                <h3 class="text-lg font-semibold text-surface-900 dark:text-white mb-1">
                  {cert.name}
                </h3>
                <p class="text-sm text-primary-600 dark:text-primary-400 mb-1">{cert.issuer}</p>
                <p class="text-xs text-surface-500 dark:text-surface-400 font-mono">{cert.date}</p>
              </div>
            ))}
          </div>
        </section>
      )}

      {/* 교육/수료 */}
      {training.length > 0 && (
        <section>
          <h2 class="text-xl font-semibold text-surface-900 dark:text-white mb-4">교육 이력</h2>
          <div class="space-y-4">
            {training.map((t) => (
              <div class="card">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-1">
                  <h3 class="text-lg font-semibold text-surface-900 dark:text-white">
                    {t.name}
                  </h3>
                  <span class="text-sm text-surface-500 dark:text-surface-400 font-mono">{t.period}</span>
                </div>
                <p class="text-sm text-primary-600 dark:text-primary-400 mb-2">{t.institution}</p>
                {t.description && (
                  <p class="text-sm text-surface-600 dark:text-surface-300">{t.description}</p>
                )}
              </div>
            ))}
          </div>
        </section>
      )}

      {/* 학력 */}
      {education.length > 0 && (
        <section>
          <h2 class="text-xl font-semibold text-surface-900 dark:text-white mb-4">학력</h2>
          <div class="space-y-4">
            {education.map((edu) => (
              <div class="card">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-1">
                  <h3 class="text-lg font-semibold text-surface-900 dark:text-white">
                    {edu.name}
                  </h3>
                  <span class="text-sm text-surface-500 dark:text-surface-400 font-mono">{edu.period}</span>
                </div>
                <p class="text-sm text-primary-600 dark:text-primary-400">
                  {edu.degree} · {edu.major}
                </p>
              </div>
            ))}
          </div>
        </section>
      )}

      {/* 언어 */}
      {languages.length > 0 && (
        <section>
          <h2 class="text-xl font-semibold text-surface-900 dark:text-white mb-4">언어</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {languages.map((lang) => (
              <div class="card">
                <h3 class="text-lg font-semibold text-surface-900 dark:text-white mb-1">
                  {lang.name}
                </h3>
                <p class="text-sm text-primary-600 dark:text-primary-400">{lang.level}</p>
                {lang.note && (
                  <p class="text-xs text-surface-500 dark:text-surface-400 mt-1">{lang.note}</p>
                )}
              </div>
            ))}
          </div>
        </section>
      )}
    </div>
  )}
</BaseLayout>
