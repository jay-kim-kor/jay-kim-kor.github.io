---
import BaseLayout from '../layouts/BaseLayout.astro';

interface Skill {
  name: string;
  level?: string;
  years?: number;
}

interface SkillCategory {
  name: string;
  icon?: string;
  skills: Skill[];
}

interface SkillsData {
  categories: SkillCategory[];
}

let skillCategories: SkillCategory[] = [];

try {
  const yamlFiles = import.meta.glob('../content/skills.yaml', { eager: true, query: '?raw', import: 'default' });
  const raw = Object.values(yamlFiles)[0] as string | undefined;
  if (!raw) {
    const fallback = import.meta.glob('../data/skills.yaml', { eager: true, query: '?raw', import: 'default' });
    const rawFallback = Object.values(fallback)[0] as string | undefined;
    if (rawFallback) {
      const { load } = await import('js-yaml');
      const data = load(rawFallback) as SkillsData | SkillCategory[] | null;
      if (data && 'categories' in data) {
        skillCategories = data.categories;
      } else if (Array.isArray(data)) {
        skillCategories = data;
      }
    }
  } else {
    const { load } = await import('js-yaml');
    const data = load(raw) as SkillsData | SkillCategory[] | null;
    if (data && 'categories' in data) {
      skillCategories = data.categories;
    } else if (Array.isArray(data)) {
      skillCategories = data;
    }
  }
} catch {
  // YAML íŒŒì¼ì´ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœ ìœ ì§€
}

const iconMap: Record<string, string> = {
  container: 'ğŸ“¦',
  monitoring: 'ğŸ“Š',
  cloud: 'â˜ï¸',
  automation: 'âš™ï¸',
  network: 'ğŸŒ',
  server: 'ğŸ–¥ï¸',
  middleware: 'ğŸ”',
  code: 'ğŸ’»',
};

const levelConfig: Record<string, { label: string; width: string; color: string }> = {
  advanced: { label: 'Advanced', width: 'w-full', color: 'bg-primary-500' },
  intermediate: { label: 'Intermediate', width: 'w-2/3', color: 'bg-primary-500/60' },
  beginner: { label: 'Beginner', width: 'w-1/3', color: 'bg-primary-500/30' },
};
---

<BaseLayout title="Skills" description="ê¸°ìˆ  ìŠ¤íƒ">
  <h1 class="section-title">Skills</h1>

  {skillCategories.length === 0 ? (
    <div class="card text-center py-12">
      <p class="text-surface-500 dark:text-surface-400">ì½˜í…ì¸  ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
    </div>
  ) : (
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {skillCategories.map((cat) => (
        <div class="card">
          {/* Category Header */}
          <div class="flex items-center gap-3 mb-5">
            <span class="text-2xl">{iconMap[cat.icon ?? ''] ?? 'ğŸ”§'}</span>
            <h3 class="text-lg font-semibold text-surface-900 dark:text-white">
              {cat.name}
            </h3>
          </div>

          {/* Skills List */}
          <div class="space-y-3">
            {cat.skills.map((skill) => {
              const config = levelConfig[skill.level ?? ''] ?? levelConfig.intermediate;
              return (
                <div>
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm font-medium text-surface-800 dark:text-surface-200">
                      {skill.name}
                    </span>
                    <div class="flex items-center gap-2">
                      {skill.years && (
                        <span class="text-[10px] font-mono text-surface-500 dark:text-surface-400">
                          {skill.years}y
                        </span>
                      )}
                      <span class="text-[10px] font-medium text-primary-600 dark:text-primary-400">
                        {config.label}
                      </span>
                    </div>
                  </div>
                  {/* Level Bar */}
                  <div class="h-1.5 bg-surface-200 dark:bg-surface-800 rounded-full overflow-hidden">
                    <div
                      class:list={['h-full rounded-full transition-all duration-500', config.color, config.width]}
                    />
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      ))}
    </div>
  )}
</BaseLayout>
